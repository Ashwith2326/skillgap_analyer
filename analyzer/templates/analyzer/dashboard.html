{% extends 'analyzer/base.html' %}

{% block title %}Dashboard - Add Your Skills - Skill Gap Analyzer{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
        <div>
            <h1>üë®‚Äçüéì Welcome, {{ user.username }}!</h1>
            <p>Select your current skills below</p>
        </div>
        <div class="user-info">
            <p><strong>{{ student.get_year_display }}</strong> - {{ student.get_department_display }}</p>
            <p>CGPA: {{ student.cgpa }}</p>
        </div>
    </div>

    <!-- Form to select skills -->
    <form method="POST" id="skillsForm" class="skills-form">
        {% csrf_token %}

        <!-- Skills grouped by category -->
        {% for category, skills in skills_by_category.items %}
            <div class="skill-category">
                <h2 class="category-title">üìå {{ category }}</h2>
                <div class="skills-grid">
                    {% for skill in skills %}
                        <div class="skill-item">
                            <div class="skill-checkbox">
                                <input type="checkbox" 
                                       id="skill_{{ skill.id }}"
                                       name="skills" 
                                       value="{{ skill.id }}"
                                       {% if skill.id in student_skills %}checked{% endif %}
                                       data-difficulty="{{ skill.difficulty_level }}">
                                <label for="skill_{{ skill.id }}">
                                    <strong>{{ skill.name }}</strong>
                                    <span class="difficulty-badge difficulty-{{ skill.difficulty_level|lower }}">
                                        {{ skill.get_difficulty_level_display }}
                                    </span>
                                </label>
                            </div>
                            
                            <!-- Proficiency selector (appears when checked) -->
                            <div class="proficiency-selector" id="prof_{{ skill.id }}" style="display:none;">
                                <label>Your Proficiency:</label>
                                <select name="proficiency_{{ skill.id }}" class="proficiency-select">
                                    {% for value, label in proficiency_choices %}
                                        <option value="{{ value }}">{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <p class="skill-description">{{ skill.description|truncatewords:15 }}</p>
                        </div>
                    {% empty %}
                        <p class="no-skills">No skills in this category yet</p>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}

        <!-- Action Buttons -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large">
                ‚úì Save Skills & Continue
            </button>
            <p class="form-hint">
                üí° <strong>Tip:</strong> Select skills you are confident about. 
                You can update this anytime.
            </p>
        </div>
    </form>

    <!-- Info Box -->
    <div class="info-section">
        <h3>üìã How It Works</h3>
        <ol>
            <li><strong>Select Skills:</strong> Choose skills you currently possess</li>
            <li><strong>Rate Proficiency:</strong> Indicate your level (Basic/Intermediate/Expert)</li>
            <li><strong>Select Role:</strong> Choose a job role and company</li>
            <li><strong>Get Report:</strong> See your skill gaps and learning recommendations</li>
        </ol>
    </div>
</div>

<!-- JavaScript to show/hide proficiency selector -->
<script>
    document.querySelectorAll('input[name="skills"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const profDiv = document.getElementById('prof_' + this.value);
            if (this.checked) {
                profDiv.style.display = 'block';
            } else {
                profDiv.style.display = 'none';
            }
        });
        
        // Initialize on page load
        if (checkbox.checked) {
            document.getElementById('prof_' + checkbox.value).style.display = 'block';
        }
    });
</script>

<style>
    .skills-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }

    .skill-item {
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        background: #f9f9f9;
    }

    .skill-checkbox input[type="checkbox"] {
        margin-right: 10px;
    }

    .difficulty-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        margin-left: 10px;
    }

    .difficulty-beginner {
        background: #d4edda;
        color: #155724;
    }

    .difficulty-intermediate {
        background: #fff3cd;
        color: #856404;
    }

    .difficulty-advanced {
        background: #f8d7da;
        color: #721c24;
    }

    .proficiency-selector {
        margin-top: 10px;
        padding: 10px;
        background: white;
        border-left: 3px solid #007bff;
    }

    .form-actions {
        margin-top: 40px;
        text-align: center;
    }

    .btn-large {
        padding: 12px 40px;
        font-size: 1.1em;
    }
</style>
{% endblock %}
