{% extends 'analyzer/base.html' %}

{% block title %}Select Role - Skill Gap Analyzer{% endblock %}

{% block content %}
<div class="role-selection-container">
    <!-- Header -->
    <div class="page-header">
        <h1>üè¢ Select Company & Role</h1>
        <p>Choose the position you want to analyze your skills against</p>
    </div>

    <!-- Role Selection Form -->
    <form method="POST" id="roleForm">
        {% csrf_token %}

        <div class="companies-grid">
            {% for company in companies %}
                <div class="company-card">
                    <div class="company-header">
                        <h2>{{ company.name }}</h2>
                        <span class="company-code">{{ company.code }}</span>
                    </div>
                    
                    <p class="company-description">{{ company.description|truncatewords:20 }}</p>
                    
                    <div class="company-info">
                        <p><strong>HQ:</strong> {{ company.headquarters }}</p>
                        <p><strong>Est.:</strong> {{ company.established_year }}</p>
                    </div>

                    <!-- Job Roles for this company -->
                    <div class="roles-list">
                        <h3>Available Positions:</h3>
                        {% if company.job_roles.all %}
                            <div class="roles">
                                {% for role in company.job_roles.all %}
                                    <div class="role-option">
                                        <input type="radio" 
                                               id="role_{{ role.id }}" 
                                               name="job_role" 
                                               value="{{ role.id }}"
                                               required>
                                        <label for="role_{{ role.id }}" class="role-label">
                                            <div class="role-title">{{ role.title }}</div>
                                            <div class="role-details">
                                                <span class="salary">üí∞ {{ role.salary_range }}</span>
                                                <span class="experience">üìä {{ role.get_required_experience_display }}</span>
                                            </div>
                                            <div class="role-description">{{ role.description|truncatewords:15 }}</div>
                                        </label>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p class="no-roles">No roles available</p>
                        {% endif %}
                    </div>
                </div>
            {% empty %}
                <div class="no-data">
                    <p>üì≠ No companies available yet. Please contact admin.</p>
                </div>
            {% endfor %}
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large">
                Analyze My Skills for Selected Role ‚ûú
            </button>
        </div>
    </form>
</div>

<style>
    .role-selection-container {
        padding: 20px 0;
    }

    .companies-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 25px;
        margin: 30px 0;
    }

    .company-card {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        padding: 25px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .company-card:hover {
        border-color: #007bff;
        box-shadow: 0 4px 12px rgba(0,123,255,0.2);
    }

    .company-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .company-header h2 {
        margin: 0;
        font-size: 1.5em;
    }

    .company-code {
        background: #007bff;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-weight: bold;
        font-size: 0.9em;
    }

    .company-info {
        font-size: 0.9em;
        color: #666;
        margin: 10px 0;
    }

    .company-info p {
        margin: 5px 0;
    }

    .roles-list {
        margin-top: 20px;
    }

    .roles-list h3 {
        margin: 15px 0 10px;
        font-size: 1em;
        color: #333;
    }

    .roles {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .role-option {
        display: none;  /* Hidden by default */
    }

    .role-option input[type="radio"] {
        display: none;
    }

    .role-option input[type="radio"] + .role-label {
        display: block;
        padding: 12px;
        background: #f5f5f5;
        border: 2px solid transparent;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .role-option input[type="radio"]:checked + .role-label {
        background: #e7f3ff;
        border-color: #007bff;
        box-shadow: inset 0 0 0 3px #e7f3ff;
    }

    .role-label {
        margin: 0;
    }

    .role-title {
        font-weight: bold;
        color: #000;
        margin-bottom: 5px;
    }

    .role-details {
        display: flex;
        gap: 15px;
        font-size: 0.85em;
        color: #666;
        margin-bottom: 8px;
    }

    .role-description {
        font-size: 0.85em;
        color: #555;
        line-height: 1.4;
    }

    /* Show role options for first company or selected company */
    .company-card:first-child .role-option,
    .company-card:has(input:checked) .role-option {
        display: block;
    }

    .form-actions {
        text-align: center;
        margin: 40px 0;
    }

    .no-data {
        grid-column: 1 / -1;
        text-align: center;
        padding: 40px;
        background: #f9f9f9;
        border-radius: 10px;
    }
</style>
{% endblock %}
